<!-- 202233207 김도연
cart.ejs -->
<form id="cartForm" method="post">
  <table
    class="table table-bordered border-primary table-hover"
    style="text-align: center"
  >
    <thead class="table-primary">
      <tr>
        <th>구매선택</th>
        <th>상품</th>
        <th>상품명</th>
        <th>단가</th>
        <th>담은날</th>
        <th>수량</th>
      </tr>
    </thead>
    <tbody>
      <% if (cartItems && cartItems.length > 0) { %> <%
      cartItems.forEach(function(item) { %>
      <tr>
        <td>
          <input type="checkbox" name="cart_id" value="<%= item.cart_id %>" />
        </td>
        <td>
          <% if (item.image) { %>
          <img
            src="/images/<%= item.image %>"
            style="width: 60px; height: auto"
          />
          <% } else { %>
          <span style="color: gray">이미지 없음</span>
          <% } %>
        </td>
        <td><%= item.name %></td>
        <td><%= item.price ? item.price.toLocaleString('ko-KR') : '' %> 원</td>
        <td><%= item.date || '' %></td>
        <td>
          <input
            type="number"
            name="qty"
            min="1"
            value="1"
            style="width: 60px"
          />
        </td>
      </tr>
      <% }); %> <% } else { %>
      <tr>
        <td colspan="6">장바구니가 비었습니다.</td>
      </tr>
      <% } %>
    </tbody>
  </table>
  <div style="text-align: right; margin-top: 10px">
    <button
      type="button"
      class="btn btn-outline-primary btn-sm"
      onclick="return checkCart('pay')"
    >
      결제
    </button>
    <button
      type="button"
      class="btn btn-outline-primary btn-sm"
      onclick="return checkCart('delete')"
    >
      삭제
    </button>
    <a href="/"
      ><button class="btn btn-outline-primary btn-sm" type="button">
        상품 목록 돌아가기
      </button></a
    >
  </div>
</form>

<script>
  function checkCart(action) {
    const checkboxes = document.querySelectorAll(
      'input[name="cart_id"]:checked'
    );
    if (checkboxes.length === 0) {
      alert(
        action === "pay"
          ? "구매할 상품을 선택해 주세요"
          : "삭제할 상품을 선택해 주세요"
      );
      return false;
    }
    if (action === "pay") {
      document.getElementById("cartForm").action = "/purchase/cart_pay";
      document.getElementById("cartForm").submit();
    } else {
      if (confirm("정말로 삭제하시겠습니까?")) {
        document.getElementById("cartForm").action = "/purchase/cart_delete";
        document.getElementById("cartForm").submit();
      }
    }
    return false;
  }
</script>
